# eureka_navigation
eureka_navigation - пакет предназначенный для запуска стека навигации для ровера Eureka.

### Описание

eureka_navigation пакет состоящий главным образом из ```.launch``` файлов, хранящих в себе информацию необходимую для запуска всего стека навигации на ровере. 
В папке launch хранятся необходимые для запуска launch-файлы, главным из которых является ```nav2tune.launch.py``` файл. Остальные файлы служат в качестве debug launch-файлов
необходимых для отлаживания отдельных аспектов стека навигации на ровере.

Для запуска навигации необходимо ввести следующую команду в новой bash-сессии:

``` ros2 launch eureka_navigation nav2tune.launch.py ```

### Описание главного launch-файла

Главным launch-файлом пакета является ```nav2tune.launch.py```. Он запускает следующие подсистемы необходимые для обеспечения навигации на ровере:

- ```realsense setup launch``` - launch-файл из пакета ```eureka_camera_2```, который предоставляет топики с realsense D435i сенсора в систему ровера.
- ```localization setup launch``` - launch-файл из пакета ```eureka_localization```, который предоставляет локализацию на основе данных с imu и одометрии в систему ровера.
- ```nav2 bringup launch``` - launch-файл из пакета ```nav2_bringup```, который запускает службы стека навигации (служба построения пути, преобразования пути в воздействия) в
системе ровера. Службы начинают потреблять информацию предоставляемую локализацией и сенсорами.
- ```rtabmap setup node``` - главный узел из пакета ```rtabmap```, который реализует функции графового SLAM алгоритма и предоставляет возможнсти построения карты и абсолютной 
локализации (в tf графе представляется в виде трансформации map->odom). Данный узел также потребляет информацию с сенсоров и локализации.
- ```eureka_inverse setup node``` - узел являющийся проводником между командами поступающими от стека навигации к узлу рассчета управляющих воздействий (eureka_ackermann) и узлом расчета 
управляющих воздействий. Главная задача данного узла, преобразовать угловые скорости из стека навигации в приемлимый для узла рассчета управляющих воздействи вид.

### Конфигурируемые параметры

Во избежание перекомпиляции пакетов использующихся в данном пакете в исходном коде каждого добавлены конструкции позволяющие передавать параметры параметры для всех узлов в отдельности. Среди них:

Основные параметры узла Rtabmap:
- ```subscribe_depth: (bool)``` - параметр, указывающий узлу необходимость использования depth информации с камеры d435i.
- ```subscribe_scan_cloud: (bool)``` - параметр, указывающий узлу необходимость использования сгенерированного камерой d435i облака точек в алгоритме.
- ```frame_id: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который будет использован в качестве базового (необходим, чтоб 
сообщить системе о потомке дерева трансформации, который будет указывать на некую точку модели ровера в алгоритме, которую можно считать геометрическим центром корпуса ровера).
- ```map_frame_id: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который будет использован в качестве начала глобальной системы координат в алгоритме.
- ```odom_frame_id: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который будет использова в качестве начала локальной системы координа в алгоритме.
- ```publish_tf: (bool)``` - параметр, укызывающий узлу на необходимость публикации трансформации из локальной системы координат в глобальную (предоставляющий трансформацию map->odom) в дерево
трансформации.
- ```"Mem/IncrementalMemory": (string)``` - параметр, указывающий узлу на текущий режим работы. Если данный параметр принимает значение ```true```, то узел будет работать в качествет SLAM
алгоритма, а если параметр принимает значение ```false```, то узле будет работать в режиме локализации (т.е. узлу будет необходимо предоставить дополнительную информацию в виде карты, являющейся 
облаком точек)
- ```wheel_track: (double)``` - параметр модели ровера, указывающий узлу ширину следа ровера (необходимый параметр для рассчета одометрии).
- ```measure_error (double)``` - параметр, указывающий ошибку (неучетнных параметров ровера) при рассчете одометрии (подбирается эмпирически).

Основные параметры узла bt_navigator:
- ```global_frame: (string)``` - параметр, указывающий названия потомка в дереве трансформации tf, который узел ```bt_navigator``` будет использовать в качестве начала глобальной системы координат.
- ```robot_base_frame: (string)``` - параметр, указывающий названия потомка в дереве трансформации tf, который узел ```bt_navigator``` будет использовать в качестве начала системы координат связанной 
с корпусом ровера.
- ```default_nav_to_pose_bt_xml: (string)``` - параметр, указающий путь до дерево поведения в системе. На основе данного дерева поведения будет построена навигация ровера до целевой точки.
- ```default_nav_through_poses_bt_xml: (string)``` - параметр, указающий путь до дерево поведения в системе. На основе данного дерева поведения будет построена навигация ровера через
набор точек до целевой точки.

Основные параметры узла controller_server:
- ```controller_frequency: (double)``` - параметр, указывающий частоту рассчета алгоритма управления.
- ```goal_checker_plugins: (string array)``` - параметр, указывающий набор плагинов (динамически подгружаемых библиотек), которые выполняют функции проверки достижения целевой точки.
- ```controller_plugins: (string array)``` - параметр, указывающий набор плагинов, который выполняют функции контроля движения ровера по созданному маршруту.

Основные параметры узла local_costmap (полность повторяют параметры узал global_costmap):
- ```update_frequency: (double)``` - параметр, указывающий частоту рассчета алгоритма карты стоимости.
- ```publish_frequency: (double)``` - параметр, указывающий частоту публикации данных из алгоритма стоимости.
- ```global_frame: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который узел ```local_costmap``` будет использовать в качестве глобальной системы координат.
- ```robot_base_frame: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который узел ```local_costmap``` будет использовать в качестве начала системы координат связанной с 
корпусом ровера.
- ```width: (double)``` - параметр, указывающий длину карты стоимости.
- ```height: (double)``` - параметр, указывающий ширину карты стоимости.
- ```resolution: (double)``` - параметр, указывающий размер минимальной яичейки в карте стоимости (указывается в метрах).
- ```footprint: (double pair array)``` - параметр, указывающий на геометрические размеры корпуса ровера.

Основные параметры узла planner_server:
- ```expected_planner_frequency: (double)``` - параметр, указывающий частоту рассчета алгоритма построения пути.
- ```planner_plugins: (string array) ``` - параметр, указывающий плагины, контроллирующие построение пути.

Основные параметры узла smoother_server:
- ```smoother_plugins: (string array)``` - параметр, указывающий плагины, контроллирующие "сглаживание" построенного маршрута.

Основные параметры узла behavior_server:
- ```costmap_topic: (string)``` - параметр, указывающий топик на который необходимо подписаться для получения информации о карте стоимости в системе.
- ```footprint_topic: (string)``` - параметр, указывающий топик на который необходимо подписаться для получения информации о геометрических размерах ровера.
- ```behavior_plugins: (string array)``` - параметр, указывающий плагины, контроллирующие поведение ровера в непредусмотренных ситуациях. 
- ```global_frame: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который узел ```behavior_server``` будет использовать в качестве глобальной системы координат.
- ```robot_base_frame: (string)``` - параметр, указывающий название потомка в дереве трансформации tf, который узел ```behavior_server``` будет использовать в качестве начала системы координат связанной с 
корпусом ровера.

Основные параметры узла velocity_smoother:
- ```smoothing_frequency: (double)``` - параметр, указывающий частоту рассчета алгоритма "сглаживания" путевой скорости.
- ```feedback: (string)``` - параметр, указывающий методику для рассчета скорости в алгоритме.
- ```max_velocity: (double array)``` - параметр, указывающий граничные значения скоростей, которые могут быть учтены в алгоритме.
- ```min_velocity: (double array)``` - параметр, указывающий граничные значения скоростей, которые могут быть учтены в алгоритме.
- ```max_accel: (double array)``` - параметр, указывающий граничные значения ускорений, которые могут быть учтены в алгоритме.
- ```max_decel: (double array)``` - параметр, указывающий граничные значения ускорений, которые могут быть учтены в алгоритме.

В скобках указаны типы значения которые принимают данные параметры.
